package mdb;

import javax.jms.Connection;
import javax.jms.ConnectionFactory;
import javax.jms.MessageProducer;
import javax.jms.ObjectMessage;
import javax.jms.Queue;
import javax.jms.Session;
import javax.naming.Context;
import javax.naming.InitialContext;

import model.ACLMessage;

public class AgentMsgProducer {

	public static void startMsg(ACLMessage message)
	{
		Context context = new InitialContext();
		ConnectionFactory cf = (ConnectionFactory) context
			.lookup("java:jboss/exported/jms/RemoteConnectionFactory");
		final Queue queue = (Queue) context
			.lookup("java:jboss/exported/jms/queue/agentQueue");
		context.close();
		Connection connection = cf.createConnection();
		final Session session = connection.createSession(false,
			Session.AUTO_ACKNOWLEDGE);
		
		connection.start();

		
		ObjectMessage msg = session.createObjectMessage(message);
		// The sent timestamp acts as the message's ID
		msg.setStringProperty("typeOfMessage", typeOfMessage);
		
		MessageProducer producer = session.createProducer(queue);
		producer.send(msg);
		
		//Thread.sleep(1000);
		//Message m = consumer.receive();
		//System.out.println(m.getStringProperty("received"));
		
		producer.close();
		//consumer.close();
		connection.stop();
	}
}
