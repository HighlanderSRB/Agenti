package utility;

import java.io.File;
import java.io.IOException;
import java.net.MalformedURLException;
import java.net.URL;
import java.net.URLClassLoader;
import java.util.ArrayList;
import java.util.Enumeration;
import java.util.List;
import java.util.jar.JarEntry;
import java.util.jar.JarFile;

public class ReflectionUtils {

	public static List<String> getAllAgents(String URI)
	{
		ArrayList<String> retVal = new ArrayList<String>();
		File folder = new File(URI);
		File[] listOfFiles = folder.listFiles();

	    for (int i = 0; i < listOfFiles.length; i++) {
	      if (listOfFiles[i].isFile()) {
	        retVal.add(listOfFiles[i].getName());
	      } else if (listOfFiles[i].isDirectory()) {
	    	  retVal.addAll(getAllAgents(URI+"/"+listOfFiles[i].getName()));
	      }
	    }
		return retVal;
	}
	
	public static List<String> getClasses(String pathToJar){
		ArrayList<String> retVal = new ArrayList<String>();
		JarFile jarFile = null;
		try {
			jarFile = new JarFile(pathToJar);
		} catch (IOException e1) {
			// TODO Auto-generated catch block
			e1.printStackTrace();
		}
		Enumeration<JarEntry> e = jarFile.entries();
	
		URL[] urls = new URL[1];
		try {
			urls[0] = new URL("jar:file:" + pathToJar+"!/");
		} catch (MalformedURLException e2) {
			// TODO Auto-generated catch block
			e2.printStackTrace();
		}
		URLClassLoader cl = URLClassLoader.newInstance(urls);
	
		while (e.hasMoreElements()) {
		    JarEntry je = e.nextElement();
		    if(je.isDirectory() || !je.getName().endsWith(".class")){
		        continue;
		    }
		    // -6 because of .class
		    String className = je.getName().substring(0,je.getName().length()-6);
		    className = className.replace('/', '.');
		    String[] classInfo = className.split("\\.");
		    if(classInfo[0].equals("agents"))
		    {
		    	retVal.add(className);
		    }
	
		}
		try {
			jarFile.close();
		} catch (IOException e1) {
			// TODO Auto-generated catch block
			e1.printStackTrace();
		}
		return retVal;
	}
	
	public static void main(String[] args)
	{
		List<String> str = getClasses("C:/Users/Komp/Desktop/Agenti/wildfly-9.0.2.Final/bin/Agents.jar");
		for(String s : str)
		{
			System.out.println(s);
		}
	}
	

}
